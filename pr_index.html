<!-- Include Leaflet CSS and JavaScript files -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
  integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
  crossorigin="" />
<script
  src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
  integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
  crossorigin=""></script>

<!-- Create a map container -->
<div id="map" style="height: 500px"></div>

<!-- Include your JavaScript code -->
<script>
  fetch("http://ip-api.com/json/?fields=61439")
    .then((res) => res.json())
    .then((res) => console.log(res));
  // -------------------------------------
  // An example script for redirecting users from USA to https://google.com/
  // and users from Canada to https://google.ca/

  // ip-api endpoint URL
  // we need only the countryCode, but you can request more fields
  // see http://ip-api.com/docs/api:json for documentation
  var endpoint = "http://ip-api.com/json/?fields=status,message,countryCode";

  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function () {
    if (this.readyState == 4 && this.status == 200) {
      var response = JSON.parse(this.responseText);
      if (response.status !== "success") {
        console.log("query failed: " + response.message);
        return;
      }
      // Redirect
      if (response.countryCode == "US") {
        window.location.replace("https://google.com/");
      }
      if (response.countryCode == "CA") {
        window.location.replace("https://google.ca/");
      }
    }
  };
  xhr.open("GET", endpoint, true);
  xhr.send();
  // An example script for finding out the distance from the user to multiple points

  // Coordinates and name
  var coords = [
    { lat: 40.7127837, lon: -74.0059413, name: "New York, NY" },
    { lat: 34.0522342, lon: -118.2436849, name: "Los Angeles, CA" },
    { lat: 37.3382082, lon: -121.8863286, name: "San Jose, CA" },
    { lat: 41.8781136, lon: -87.6297982, name: "Chicago, IL" },
    { lat: 47.6062095, lon: -122.3320708, name: "Seattle, WA" },
  ];

  // ip-api endpoint URL
  // see http://ip-api.com/docs/api:json for documentation
  var endpoint = "http://ip-api.com/json/?fields=status,message,lat,lon";

  function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
    var R = 6371; // Radius of the earth in km
    var dLat = deg2rad(lat2 - lat1); // deg2rad below
    var dLon = deg2rad(lon2 - lon1);
    var a =
      Math.sin(dLat / 2) * Math.sin(dLat / 2) +
      Math.cos(deg2rad(lat1)) *
        Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) *
        Math.sin(dLon / 2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    var d = R * c; // Distance in km
    return d;
  }

  function deg2rad(deg) {
    return deg * (Math.PI / 180);
  }

  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function () {
    if (this.readyState == 4 && this.status == 200) {
      var response = JSON.parse(this.responseText);
      if (response.status !== "success") {
        console.log("query failed: " + response.message);
        return;
      }
      // Distance in kilometers for each coordinate
      for (var i = 0; i < coords.length; i++) {
        var diff = getDistanceFromLatLonInKm(
          coords[i].lat,
          coords[i].lon,
          response.lat,
          response.lon
        );
        console.log("distance to " + coords[i].name + ": " + diff + "km");
      }
    }
  };
  xhr.open("GET", endpoint, true);
  xhr.send();
  // -----------------------------------
  // Create a new Leaflet map instance
  var map = L.map("map").setView([51.505, -0.09], 13);

  // Add a marker to the map
  var marker = L.marker([51.5, -0.09]).addTo(map);

  // Add a popup to the marker
  marker.bindPopup("London");

  //   ----------------------------------------------
  // Labels on top of basemap
  map.createPane("labels");
  map.getPane("labels").style.zIndex = 650;
  // disable pointer events for it
  map.getPane("labels").style.pointerEvents = "none";
  // CartoDB's Positron map tiles for the map background
  var positron = L.tileLayer(
    "https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",
    {
      attribution: "©OpenStreetMap, ©CartoDB",
    }
  ).addTo(map);
  // CartoDB's Positron map tiles for the labels
  var positronLabels = L.tileLayer(
    "https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",
    {
      attribution: "©OpenStreetMap, ©CartoDB",
      pane: "labels",
    }
  ).addTo(map);

  //   ----------------------------------------------
</script>
